<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <title>{{ site.title }} | {{site.affiliation}}</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{{ site.description }}">
    {% if site.keywords %}
    <meta name="keywords" content="{{ site.keywords }}">
    {% endif %}
    {% if site.canonical %}
    <link rel="canonical" href="{{ site.canonical }}"/>
    {% endif %}

    <link rel="icon" media="(prefers-color-scheme:dark)" href="{{ site.favicon_dark }}" type="image/png" />
    <link rel="icon" media="(prefers-color-scheme:light)" href="{{ site.favicon }}" type="image/png" />
    <script src="./assets/js/favicon-switcher.js" type="application/javascript"></script>

    <link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous>
    <link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin=anonymous>

    {% if site.font == "Sans Serif" %}
    <link rel="stylesheet" href="./assets/css/font_sans_serif.css">
    {% else %}
    <link rel="stylesheet" href="./assets/css/font.css">
    {% endif %}
    {% if site.auto_dark_mode %}
    <link rel="stylesheet" href="./assets/css/style.css">
    <link rel="stylesheet" href="./assets/css/publications.css">
    {% else %}
    <link rel="stylesheet" href="./assets/css/style-no-dark-mode.css">
    <link rel="stylesheet" href="./assets/css/publications-no-dark-mode.css">
    {% endif %}

    <style>
      /* Favicon next to About Me heading */
      .about-me-favicon {
        width: 48px !important;
        height: 48px !important;
        margin-left: 10px !important;
        vertical-align: middle !important;
        display: inline-block !important;
        cursor: pointer !important;
        transition: transform 0.2s ease !important;
        position: absolute !important;
        margin-top: -10px !important;
      }

      .about-me-favicon.dragging {
        position: fixed !important;
        z-index: 9999 !important;
        pointer-events: none !important;
        animation: none !important;
        margin-left: 0 !important;
      }

      .about-me-favicon.placed {
        position: fixed !important;
        z-index: 9999 !important;
        margin-left: 0 !important;
        cursor: grab !important;
      }

      .about-me-favicon.placed:not(.fade-out) {
        animation: none !important;
      }

      .about-me-favicon:hover:not(.dragging) {
        transform: scale(1.1) !important;
      }

      /* Cursor pointer for profile photo */
      #profile-photo {
        cursor: pointer !important;
        transition: transform 0.3s ease !important;
      }

      #profile-photo:hover {
        transform: scale(1.05) !important;
      }
    </style>

  </head>
  <body>
    <div class="wrapper">
      <header>
        
        {% if site.avatar %}
        <a class="image avatar" id="profile-photo"><img src="{{ site.avatar }}" alt="avatar" /></a>
        {% endif %}

        <h1>{{ site.title }}</h1>

        {% if site.position %}
        <position style="font-size:1.10rem;">{{ site.position }}</position>
        <br>
        {% endif %}
        {% if site.affiliation %}
        <a href="{{ site.affiliation_link }}" rel="noopener"><autocolor>{{ site.affiliation }}</autocolor></a>
        <br>
        {% endif %}
        {% if site.email %}
        <email>{{ site.email }}</email>
        {% endif %}

        <br>
        <br>
        <div class="social-icons">
        {% if site.google_scholar %}
        <a style="margin: 0 5px 0 0" href="{{ site.google_scholar }}">
          <i class="ai ai-google-scholar" style="font-size:1.2rem"></i>
        </a>  
        {% endif %}

        {% if site.cv_link %}
        <a style="margin: 0 5px 0 0" href="{{ site.cv_link }}">
          <i class="ai ai-cv" style="font-size:1.3rem;"></i>
        </a>
        {% endif %}

        {% if site.github_link %}
        <a style="margin: 0 5px 0 0" href="{{ site.github_link }}">
          <i class="fab fa-github"></i>
        </a>
        {% endif %}

        {% if site.linkedin %}
        <a style="margin: 0 5px 0 0" href="{{ site.linkedin }}">
          <i class="fab fa-linkedin"></i>
        </a>
        {% endif %}

        {% if site.twitter %}
        <a style="margin: 0 0 0 0" href="{{ site.twitter }}">
          <i class="fab fa-twitter"></i>
        </a>
        {% endif %}
        </div>
        <br>

      </header>
      <section>

      {{ content }}

      <br>

      {% if site.enable_footnote %}
      <p><small>Powered by Jekyll and <a href="https://github.com/yaoyao-liu/minimal-light" target="_blank" rel="noopener">Minimal Light</a> theme.</small></p>
      {% endif %}

      </section>
      <footer>
        
      </footer>
    </div>
    <script src="{{ "/assets/js/scale.fix.js" | relative_url }}"></script>
    <script>
      // Toggle favicon next to "About Me" when profile photo is clicked
      document.addEventListener('DOMContentLoaded', function() {
        const profilePhoto = document.getElementById('profile-photo');
        const favicon = '{{ site.favicon }}';
        const faviconDark = '{{ site.favicon_dark }}';
        let faviconImg = null;
        let themeChangeListener = null;
        let isDragging = false;
        let mouseMoveListener = null;
        let lastPosition = null; // Store last placed position

        if (profilePhoto) {
          profilePhoto.style.cursor = 'pointer';

          profilePhoto.addEventListener('click', function(e) {
            e.preventDefault();

            // Find the About Me heading
            const aboutMeHeading = document.querySelector('h2#about-me');

            if (aboutMeHeading) {
              // Toggle: if favicon exists, remove it immediately
              if (faviconImg && faviconImg.parentElement) {
                // Save position if it was placed
                if (faviconImg.classList.contains('placed')) {
                  lastPosition = {
                    left: faviconImg.style.left,
                    top: faviconImg.style.top
                  };
                }

                faviconImg.remove();
                faviconImg = null;

                // Remove theme change listener
                if (themeChangeListener && window.matchMedia) {
                  window.matchMedia('(prefers-color-scheme: dark)').removeEventListener('change', themeChangeListener);
                  themeChangeListener = null;
                }

                // Remove mouse move listener if dragging
                if (mouseMoveListener) {
                  document.removeEventListener('mousemove', mouseMoveListener);
                  mouseMoveListener = null;
                  isDragging = false;
                }
              } else {
                // Create favicon image element
                faviconImg = document.createElement('img');
                faviconImg.className = 'about-me-favicon';
                faviconImg.alt = 'favicon';

                // Use appropriate favicon based on color scheme
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                  faviconImg.src = faviconDark;
                } else {
                  faviconImg.src = favicon;
                }

                // Insert favicon after the heading text
                aboutMeHeading.appendChild(faviconImg);

                // If there was a last position, restore it
                if (lastPosition) {
                  faviconImg.classList.add('placed');
                  faviconImg.style.left = lastPosition.left;
                  faviconImg.style.top = lastPosition.top;
                }

                // Add click event to favicon for dragging
                faviconImg.addEventListener('click', function(e) {
                  e.stopPropagation();

                  if (!isDragging) {
                    // Start dragging - make it follow mouse
                    isDragging = true;
                    faviconImg.classList.add('dragging');

                    mouseMoveListener = function(e) {
                      if (faviconImg && isDragging) {
                        faviconImg.style.left = (e.clientX - 18) + 'px'; // Center the icon
                        faviconImg.style.top = (e.clientY - 18) + 'px';
                      }
                    };

                    document.addEventListener('mousemove', mouseMoveListener);

                    // Add click listener to place favicon at desired position
                    const clickToPlaceListener = function(e) {
                      if (isDragging && e.target !== faviconImg) {
                        // Stop dragging and keep favicon at current position
                        isDragging = false;
                        faviconImg.classList.remove('dragging');
                        faviconImg.classList.add('placed');

                        if (mouseMoveListener) {
                          document.removeEventListener('mousemove', mouseMoveListener);
                          mouseMoveListener = null;
                        }

                        document.removeEventListener('click', clickToPlaceListener);
                      }
                    };

                    // Add slight delay to avoid immediate placement
                    setTimeout(function() {
                      document.addEventListener('click', clickToPlaceListener);
                    }, 100);
                  }
                });

                // Listen for theme changes and update favicon
                if (window.matchMedia) {
                  themeChangeListener = function(e) {
                    if (faviconImg) {
                      faviconImg.src = e.matches ? faviconDark : favicon;
                    }
                  };
                  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', themeChangeListener);
                }
              }
            }
          });
        }
      });
    </script>
    {% if site.google_analytics %}
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', '{{ site.google_analytics }}', 'auto');
      ga('send', 'pageview');
    </script>
    {% endif %}
  </body>
</html>
